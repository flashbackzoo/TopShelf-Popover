// TopShelf - Popover ~ Copyright (c) 2011 - 2012 David Craig, https://github.com/flashbackzoo/TopShelf-Popover
// Released under MIT license, http://www.opensource.org/licenses/mit-license.php
(function(a){a.fn.tsPopover=function(b,c){var d=[];var e={drag:function(b,c,d){a(b).css({top:c+"px",left:d+"px"})},simple:{tranIn:function(b){g.mask(b.settings.mask,function(){a("[data-ui*='popover-mask']").show()});a(b.container).show();g.openCallback(b)},tranOut:function(b){g.mask(b.settings.mask,function(){a("[data-ui*='popover-mask']").hide()});a(b.container).hide();g.closeCallback(b)}},fade:{tranIn:function(b){g.mask(b.settings.mask,function(){a("[data-ui*='popover-mask']").fadeIn()});a(b.container).fadeIn(function(){g.openCallback(b)})},tranOut:function(b){g.mask(b.settings.mask,function(){a("[data-ui*='popover-mask']").fadeOut()});a(b.container).fadeOut("slow",function(){g.closeCallback(b)})}}};var f={open:function(b){a("[data-ui*='popover-trigger'][href='"+b.container.id+"']").addClass("current");a(b.container).addClass("current");e[b.settings.transition].tranIn(b)},close:function(b){a("[data-ui*='popover-trigger'].current").removeClass("current");a(b.container).removeClass("current");e[b.settings.transition].tranOut(b)}};var g={mask:function(a,b){if(a){b()}},drag:function(a,b,c){e.drag(a.container,b,c)},openCallback:function(a){if(a.settings.callbacks.open!==undefined){a.settings.callbacks.open()}},closeCallback:function(a){g.resetPopover(a);if(a.settings.callbacks.close!==undefined){a.settings.callbacks.close()}},resetPopover:function(b){a(b.container).css({top:"",left:"","margin-left":"","margin-top":""})}};if(f[b]){return f[b].call(f,this,c)}else if(typeof b==="object"||b===undefined){var h=a.extend({transition:"simple",easyClose:true,draggable:false,mask:true,callbacks:{open:function(){return false},close:function(){return false}}},b);return this.each(function(){var b={container:this,settings:h,triggers:a("a[href='"+this.id+"']"),close:a(this).find("[data-ui*='popover-close']")[0]};var c=function(c,e){var f={};(function(){f.triggers=function(){if(b.triggers.length>0){a(b.triggers).each(function(){a(this).click(function(e){e.preventDefault();if(!a(b.container).hasClass("current")){var f=a("[data-ui*='popover-panel'][class='current']");if(f.length){a(d).each(function(a,b){c.close(b)})}c.open(b)}})})}};f.closeButton=function(){if(b.close){a(b.close).click(function(a){a.preventDefault();c.close(b)})}};f.easyClose=function(){a("html").data("easyCloseHasBeenSet",true);a(document).bind("click",function(d){var e=a("[data-ui*='popover-panel'][class$='current']")[0];if(a(d.target).closest(e).length<1&&a(d.target).attr("href")!==a(e).attr("id")){c.close(b)}})};f.drag=function(){a(b.container).bind("mousedown",function(c){var d=c.pageY-b.container.offsetTop+parseInt(a(b.container).css("margin-top"),10),f=c.pageX-b.container.offsetLeft+parseInt(a(b.container).css("margin-left"),10);a(document).bind("mousemove",function(a){e.drag(b,a.pageY-d,a.pageX-f)});a(document).bind("mouseup",function(b){a(document).unbind("mousemove");a(document).unbind("mouseup")})})}})();return f};(function(){var e=c(f,g);e.triggers();e.closeButton();if(a("html").data("easyCloseHasBeenSet")!==true&&b.settings.easyClose===true){e.easyClose()}if(b.settings.draggable===true){e.drag()}d[d.length]=b})()})}else{a.error(this)}}})(jQuery)