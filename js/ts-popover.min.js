// TopShelf - Popover ~ Copyright (c) 2011 - 2012 David Craig, https://github.com/flashbackzoo/TopShelf-Popover
// Released under MIT license, http://www.opensource.org/licenses/mit-license.php
(function(a){a.fn.tsPopover=function(b,c){function e(a,b,c){var d=_transitions;d.drag(a,b,c)}function f(b){a(b).css({top:"",left:"","margin-left":"","margin-top":""})}var d={open:function(b,c){var d=_transitions.tranIn(b,c);a("[data-ui*='popover-trigger'][href='"+b.id+"']").addClass("current");a(b).addClass("current");return b},close:function(b,c){var d=_transitions.tranOut(b);a("[data-ui*='popover-trigger'].current").removeClass("current");a(b).removeClass("current");a(b).unbind("mousemove");a(b).unbind("mouseup");c();return b}};_transitions={tranIn:function(b,c){if(g.transition=="simple"){a("[data-ui*='popover-mask']").show();a(b).css({"margin-left":"-"+a(b).outerWidth(true)/2+"px","margin-top":"-"+a(b).outerHeight(true)/2+"px"}).show()}else if(g.transition=="fade"){a("[data-ui*='popover-mask']").fadeIn();a(b).css({"margin-left":"-"+a(b).outerWidth(true)/2+"px","margin-top":"-"+a(b).outerHeight(true)/2+"px"}).fadeIn()}else if(g.transition=="slide"){a("[data-ui*='popover-mask']").show();a(b).css({"margin-left":"-"+a(b).outerWidth(true)/2+"px","margin-top":"-"+a(b).outerHeight(true)/2+"px"}).slideDown()}if(c!==undefined){c()}},tranOut:function(b){if(g.transition=="simple"){a("[data-ui*='popover-mask']").hide();a(b).hide(0,function(){f(b)})}else if(g.transition=="fade"){a("[data-ui*='popover-mask']").fadeOut();a(b).fadeOut("slow",function(){f(b)})}else if(g.transition=="slide"){a("[data-ui*='popover-mask']").fadeOut();a(b).slideUp("slow",function(){f(b)})}},drag:function(b,c,d){a(b).css({top:c+"px",left:d+"px"})}};if(d[b]){return d[b].call(d,this,c)}else if(typeof b==="object"){var g=a.extend({transition:"simple",easyClose:true,draggable:false,mask:false,callbacks:{open:function(){return false},close:function(){return false}}},b);return this.each(function(){var b={container:this,settings:g,triggers:a("a[href='"+this.id+"']"),close:a(this).find("[data-ui*='popover-close']")[0]};var c=function(c){var d={};var f=0;(function(){d.triggers=function(){if(b.triggers.length>0){for(f=0;f<b.triggers.length;f+=1){a(b.triggers[f]).bind("click",function(d){d.preventDefault();d.stopPropagation();if(!a(b.container).hasClass("current")){var e=a("[data-ui*='popover-panel'][class='current']");if(e.length){a(e).each(function(a,d){c.close(this,b.settings.callbacks.close)})}c.open(b.container,b.settings.callbacks.open)}})}}};d.closeButton=function(){if(b.close){a(b.close).bind("click",function(a){a.preventDefault();a.stopPropagation();c.close(b.container,b.settings.callbacks.close)})}};d.easyClose=function(){a("html").data("easyCloseSet",true);a(document).bind("click",function(d){var e=a("[data-ui*='popover-panel'][class$='current']")[0];if(a(d.target).closest(e).length<1&&a(d.target).attr("href")!==a(e).attr("id")){c.close(e,b.settings.callbacks.close)}})};d.drag=function(){a(b.container).bind("mousedown",function(c){var d=c.pageY-b.container.offsetTop+parseInt(a(b.container).css("margin-top"),10),f=c.pageX-b.container.offsetLeft+parseInt(a(b.container).css("margin-left"),10);a(document).bind("mousemove",function(a){e(b.container,a.pageY-d,a.pageX-f)});a(document).bind("mouseup",function(b){a(document).unbind("mousemove");a(document).unbind("mouseup")})})}})();return d};(function(){var e=c(d);var f=a("[data-ui*='popover-mask']");e.triggers();e.closeButton();if(a("html").data("easyCloseSet")!==true&&b.settings.easyClose===true){e.easyClose()}if(b.settings.draggable===true){e.drag()}if(b.settings.mask===true&&f.length<1){f="<div class='popover-mask' data-ui='popover-mask'></div>";a("body").append(f)}})()})}else{a.error(this)}}})(jQuery)
