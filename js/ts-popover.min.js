// TopShelf - Popover ~ Copyright (c) 2011 - 2012 David Craig, https://github.com/flashbackzoo/TopShelf-Popover
// Released under MIT license, http://www.opensource.org/licenses/mit-license.php
(function(a){a.fn.tsPopover=function(b){var c=a.extend({transition:"simple",easyClose:true,draggable:false,mask:false},b);return this.each(function(){var f={container:this,settings:c,triggers:a("a[href='"+this.id+"']"),close:a(this).find("[data-ui*='popover-close']")[0]};var g=function(){var h={};(function(){h.tranIn=function(i){a("[data-ui*='popover-mask']").show();a(i).show()};h.tranOut=function(i){a("[data-ui*='popover-mask']").hide();a(i).hide()};h.center=function(i){a(i).css({"margin-left":"-"+a(i).outerWidth(true)/2+"px","margin-top":"-"+a(i).outerHeight(true)/2+"px"})};h.drag=function(j,k,i){a(j).css({top:k+"px",left:i+"px"})}})();return h};var d=function(i,h){var j={};(function(){j.open=function(k){a("[data-ui*='popover-trigger'][href='"+k.id+"']").addClass("current");a(k).addClass("current");i.center(k);i.tranIn(k)};j.close=function(k){a("[data-ui*='popover-trigger'].current").removeClass("current");a(k).removeClass("current");i.tranOut(k);a(k).css({top:"",left:"","margin-left":"","margin-top":""});a(k).unbind("mousemove");a(k).unbind("mouseup")};j.drag=function(l,m,k){i.drag(l,m,k)}})();return j};var e=function(k){var h={};var j=0;(function(){h.triggers=function(){if(f.triggers.length>0){for(j=0;j<f.triggers.length;j+=1){a(f.triggers[j]).bind("click",function(i){i.preventDefault();if(!a(f.container).hasClass("current")){k.close(a("[data-ui*='popover-panel'][class='current']")[0]);k.open(f.container)}})}}};h.closeButton=function(){if(f.close){a(f.close).bind("click",function(i){i.preventDefault();k.close(f.container)})}};h.easyClose=function(){a("html").data("easyCloseSet",true);a(document).bind("click",function(l){var i=a("[data-ui*='popover-panel'][class$='current']")[0];if(a(l.target).closest(i).length<1&&a(l.target).attr("href")!==a(i).attr("id")){k.close(i)}})};h.drag=function(){a(f.container).bind("mousedown",function(l){var m=l.pageY-f.container.offsetTop+parseInt(a(f.container).css("margin-top"),10),i=l.pageX-f.container.offsetLeft+parseInt(a(f.container).css("margin-left"),10);a(f.container).bind("mousemove",function(n){k.drag(f.container,n.pageY-m,n.pageX-i)});a(f.container).bind("mouseup",function(n){a(f.container).unbind("mousemove");a(f.container).unbind("mouseup")})})};h.scrollLock=function(i){a(window).bind("mousewheel",function(l){if(a(i).css("display")!="none"){l.preventDefault()}})}})();return h};(function(){var j=g(f);var k=d(j);var i=e(k);var h=a("[data-ui*='popover-mask']");i.triggers();i.closeButton();if(a("html").data("easyCloseSet")!==true&&f.settings.easyClose===true){i.easyClose()}if(f.settings.draggable===true){i.drag()}if(f.settings.mask===true&&h.length<1){h="<div class='popover-mask' data-ui='popover-mask'></div>";a("body").append(h);i.scrollLock(a("[data-ui='popover-mask']"))}})()})}})(jQuery);