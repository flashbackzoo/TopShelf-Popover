// TopShelf - Popover ~ Copyright (c) 2011 - 2012 TopShelf Solutions Limited, https://github.com/flashbackzoo/TopShelf-Popover
// Released under MIT license, http://www.opensource.org/licenses/mit-license.php
(function(b){b.fn.tsPopover=function(c,f,j){var g=[],i={drag:function(a,k,d){b(a).css({top:k+"px",left:d+"px"})},simple:{tranIn:function(a){e.mask(a.settings.mask,function(){b("[data-ui*='popover-mask']").show()});b(a.container).show();e.openCallback(a)},tranOut:function(a){e.mask(a.settings.mask,function(){b("[data-ui*='popover-mask']").hide()});b(a.container).hide();e.closeCallback(a)}},fade:{tranIn:function(a){e.mask(a.settings.mask,function(){b("[data-ui*='popover-mask']").fadeIn()});b(a.container).fadeIn(function(){e.openCallback(a)})},tranOut:function(a){e.mask(a.settings.mask,function(){b("[data-ui*='popover-mask']").fadeOut()});b(a.container).fadeOut("slow",function(){e.closeCallback(a)})}}},h={open:function(a){b("[data-ui*='popover-trigger'][href='"+a.container.id+"']").addClass("current");b(a.container).addClass("current");i[a.settings.transition].tranIn(a)},close:function(a){b("[data-ui*='popover-trigger'].current").removeClass("current");b(a.container).removeClass("current");try{i[a.settings.transition].tranOut(a)}catch(k){}}},e={mask:function(a,b){a&&b()},drag:function(a,b,d){i.drag(a.container,b,d)},openCallback:function(a){void 0!==a.settings.callbacks.open&&a.settings.callbacks.open()},closeCallback:function(a){e.resetPopover(a);void 0!==a.settings.callbacks.close&&a.settings.callbacks.close()},resetPopover:function(a){b(a.container).css({top:"",left:"","margin-left":"","margin-top":""})},getPopoverObjectById:function(a){var e={};b(g).each(function(d,c){currentContainerId=b(c.container).attr("id");currentContainerId===a&&(e=c)});return e}};if(h[c])return f={container:this,settings:{transition:f,callbacks:{open:j,close:j}}},b("[data-ui='popover-mask']").length&&(f.settings.mask=!0),h[c].call(h,f,f);if("object"===typeof c||void 0===c){var l=b.extend({transition:"simple",easyClose:!0,draggable:!1,mask:!0,callbacks:{open:function(){return!1},close:function(){return!1}}},c);return this.each(function(){var a={container:this,settings:l,triggers:b("a[href='"+this.id+"']"),close:b(this).find("[data-ui*='popover-close']")[0]},c=function(d,e){var c={};(function(){c.triggers=function(){0<a.triggers.length&&b(a.triggers).each(function(){b(this).click(function(c){c.preventDefault();b(a.container).hasClass("current")||(b("[data-ui*='popover-panel'][class='current']").length&&b(g).each(function(a,b){d.close(b)}),d.open(a))})})};c.closeButton=function(){a.close&&b(a.close).click(function(b){b.preventDefault();d.close(a)})};c.easyClose=function(){b("html").data("easyCloseHasBeenSet",!0);b(document).bind("click",function(a){var c=b("[data-ui*='popover-panel'][class$='current']")[0];1>b(a.target).closest(c).length&&b(a.target).attr("href")!==b(c).attr("id")&&d.close(e.getPopoverObjectById(b(c).attr("id")))})};c.drag=function(){b(a.container).bind("mousedown",function(c){var d=c.pageY-a.container.offsetTop+parseInt(b(a.container).css("margin-top"),10),f=c.pageX-a.container.offsetLeft+parseInt(b(a.container).css("margin-left"),10);b(document).bind("mousemove",function(b){e.drag(a,b.pageY-d,b.pageX-f)});b(document).bind("mouseup",function(){b(document).unbind("mousemove");b(document).unbind("mouseup")})})}})();return c};(function(){var d=c(h,e);d.triggers();d.closeButton();!0!==b("html").data("easyCloseHasBeenSet")&&!0===a.settings.easyClose&&d.easyClose();!0===a.settings.draggable&&d.drag();g[g.length]=a})()})}b.error(this)}})(jQuery);