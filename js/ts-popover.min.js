// TopShelf - Popover ~ Copyright (c) 2011 - 2012 David Craig, https://github.com/flashbackzoo/TopShelf-Popover
// Released under MIT license, http://www.opensource.org/licenses/mit-license.php
(function(a){a.fn.tsPopover=function(b,c,d){var e=[];var f={drag:function(b,c,d){a(b).css({top:c+"px",left:d+"px"})},simple:{tranIn:function(b){h.mask(b.settings.mask,function(){a("[data-ui*='popover-mask']").show()});a(b.container).show();h.openCallback(b)},tranOut:function(b){h.mask(b.settings.mask,function(){a("[data-ui*='popover-mask']").hide()});a(b.container).hide();h.closeCallback(b)}},fade:{tranIn:function(b){h.mask(b.settings.mask,function(){a("[data-ui*='popover-mask']").fadeIn()});a(b.container).fadeIn(function(){h.openCallback(b)})},tranOut:function(b){h.mask(b.settings.mask,function(){a("[data-ui*='popover-mask']").fadeOut()});a(b.container).fadeOut("slow",function(){h.closeCallback(b)})}}};var g={open:function(b){a("[data-ui*='popover-trigger'][href='"+b.container.id+"']").addClass("current");a(b.container).addClass("current");f[b.settings.transition].tranIn(b)},close:function(b){a("[data-ui*='popover-trigger'].current").removeClass("current");a(b.container).removeClass("current");f[b.settings.transition].tranOut(b)}};var h={mask:function(a,b){if(a){b()}},drag:function(a,b,c){f.drag(a.container,b,c)},openCallback:function(a){if(a.settings.callbacks.open!==undefined){a.settings.callbacks.open()}},closeCallback:function(a){h.resetPopover(a);if(a.settings.callbacks.close!==undefined){a.settings.callbacks.close()}},resetPopover:function(b){a(b.container).css({top:"",left:"","margin-left":"","margin-top":""})}};if(g[b]){var i={container:this,settings:{transition:c,callbacks:{open:d,close:d}}};if(a("[data-ui='popover-mask']").length){i.settings.mask=true}return g[b].call(g,i,i)}else if(typeof b==="object"||b===undefined){var j=a.extend({transition:"simple",easyClose:true,draggable:false,mask:true,callbacks:{open:function(){return false},close:function(){return false}}},b);return this.each(function(){var b={container:this,settings:j,triggers:a("a[href='"+this.id+"']"),close:a(this).find("[data-ui*='popover-close']")[0]};var c=function(c,d){var f={};(function(){f.triggers=function(){if(b.triggers.length>0){a(b.triggers).each(function(){a(this).click(function(d){d.preventDefault();if(!a(b.container).hasClass("current")){var f=a("[data-ui*='popover-panel'][class='current']");if(f.length){a(e).each(function(a,b){c.close(b)})}c.open(b)}})})}};f.closeButton=function(){if(b.close){a(b.close).click(function(a){a.preventDefault();c.close(b)})}};f.easyClose=function(){a("html").data("easyCloseHasBeenSet",true);a(document).bind("click",function(d){var e=a("[data-ui*='popover-panel'][class$='current']")[0];if(a(d.target).closest(e).length<1&&a(d.target).attr("href")!==a(e).attr("id")){c.close(b)}})};f.drag=function(){a(b.container).bind("mousedown",function(c){var e=c.pageY-b.container.offsetTop+parseInt(a(b.container).css("margin-top"),10),f=c.pageX-b.container.offsetLeft+parseInt(a(b.container).css("margin-left"),10);a(document).bind("mousemove",function(a){d.drag(b,a.pageY-e,a.pageX-f)});a(document).bind("mouseup",function(b){a(document).unbind("mousemove");a(document).unbind("mouseup")})})}})();return f};(function(){var d=c(g,h);d.triggers();d.closeButton();if(a("html").data("easyCloseHasBeenSet")!==true&&b.settings.easyClose===true){d.easyClose()}if(b.settings.draggable===true){d.drag()}e[e.length]=b})()})}else{a.error(this)}}})(jQuery)