// TopShelf - Popover ~ Copyright (c) 2011 - 2012 TopShelf Solutions Limited, https://github.com/flashbackzoo/TopShelf-Popover
// Released under MIT license, http://www.opensource.org/licenses/mit-license.php
(function(b){b.fn.tsPopover=function(e,d,j){var f=[],i={drag:function(a,c,g){b(a).css({top:c+"px",left:g+"px"})},simple:{tranIn:function(a){c.mask(a.settings.mask,function(){b("[data-ui*='popover-mask']").show()});c.centerPopover(a);b(a.container).show();c.openCallback(a)},tranOut:function(a){c.mask(a.settings.mask,function(){b("[data-ui*='popover-mask']").hide()});b(a.container).hide();c.closeCallback(a)}},fade:{tranIn:function(a){c.mask(a.settings.mask,function(){b("[data-ui*='popover-mask']").fadeIn()});
c.centerPopover(a);b(a.container).fadeIn(function(){c.openCallback(a)})},tranOut:function(a){c.mask(a.settings.mask,function(){b("[data-ui*='popover-mask']").fadeOut()});b(a.container).fadeOut("slow",function(){c.closeCallback(a)})}}},h={open:function(a){b("[data-ui*='popover-trigger'][href='"+a.container.id+"']").addClass("current");b(a.container).addClass("current");i[a.settings.transition].tranIn(a)},close:function(a){b("[data-ui*='popover-trigger'].current").removeClass("current");b(a.container).removeClass("current");
try{i[a.settings.transition].tranOut(a)}catch(c){}}},c={mask:function(a,b){a&&b()},drag:function(a,b,c){i.drag(a.container,b,c)},openCallback:function(a){void 0!==a.settings.callbacks.open&&a.settings.callbacks.open()},closeCallback:function(a){c.resetPopover(a);void 0!==a.settings.callbacks.close&&a.settings.callbacks.close()},resetPopover:function(a){b(a.container).css({top:"",left:"","margin-left":"","margin-top":""})},getPopoverObjectById:function(a){var c={};b(f).each(function(g,e){currentContainerId=
b(e.container).attr("id");currentContainerId===a&&(c=e)});return c},centerPopover:function(a){b(a.container).css({"margin-top":"-"+b(a.container).outerHeight()/2+"px","margin-left":"-"+b(a.container).outerWidth()/2+"px"})}};if(h[e])return d={container:this,settings:{transition:d,callbacks:{open:j,close:j}}},b("[data-ui='popover-mask']").length&&(d.settings.mask=!0),h[e].call(h,d,d);if("object"===typeof e||void 0===e){var k=b.extend({transition:"simple",easyClose:!0,draggable:!1,mask:!0,callbacks:{open:function(){return!1},
close:function(){return!1}}},e);return this.each(function(){var a={container:this,settings:k,triggers:b("a[href='"+this.id+"']"),close:b(this).find("[data-ui*='popover-close']")[0]},e=function(c,e){var d={};(function(){d.triggers=function(){0<a.triggers.length&&b(a.triggers).each(function(){b(this).click(function(e){e.preventDefault();e.stopPropagation();b(a.container).hasClass("current")||(b("[data-ui*='popover-panel'][class='current']").length&&b(f).each(function(a,b){c.close(b)}),c.open(a))})})};
d.closeButton=function(){a.close&&b(a.close).click(function(b){b.preventDefault();c.close(a)})};d.easyClose=function(){b("html").data("easyCloseHasBeenSet",!0);b(document).bind("click",function(a){var d=b("[data-ui*='popover-panel'][class$='current']")[0];1>b(a.target).closest(d).length&&b(a.target).attr("href")!==b(d).attr("id")&&c.close(e.getPopoverObjectById(b(d).attr("id")))})};d.drag=function(){b(a.container).bind("mousedown",function(c){var d=c.pageY-a.container.offsetTop+parseInt(b(a.container).css("margin-top"),
10),g=c.pageX-a.container.offsetLeft+parseInt(b(a.container).css("margin-left"),10);b(document).bind("mousemove",function(b){e.drag(a,b.pageY-d,b.pageX-g)});b(document).bind("mouseup",function(){b(document).unbind("mousemove");b(document).unbind("mouseup")})})}})();return d};(function(){var d=e(h,c);d.triggers();d.closeButton();!0!==b("html").data("easyCloseHasBeenSet")&&!0===a.settings.easyClose&&d.easyClose();!0===a.settings.draggable&&d.drag();f[f.length]=a})()})}b.error(this)}})(jQuery);